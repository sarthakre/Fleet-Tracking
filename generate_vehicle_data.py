import paho.mqtt.client as mqtt
import json
import random
import time
from datetime import datetime, timedelta

# MQTT settings
BROKER = "localhost"
PORT = 1883
TOPIC = "v1/devices/me/telemetry"
ACCESS_TOKEN = "2LWF8gx9Oiai8svorOuJ" # Volvo 

ROUTE_COORDINATES = [
    {"lat": 37.771210000, "lng": -122.510960000},
{"lat": 37.771340000, "lng": -122.510980000},
{"lat": 37.771340000, "lng": -122.510980000},
{"lat": 37.771360000, "lng": -122.510850000},
{"lat": 37.771380000, "lng": -122.510550000},
{"lat": 37.771400000, "lng": -122.509900000},
{"lat": 37.771410000, "lng": -122.509660000},
{"lat": 37.771430000, "lng": -122.509360000},
{"lat": 37.771430000, "lng": -122.509270000},
{"lat": 37.771450000, "lng": -122.508840000},
{"lat": 37.771490000, "lng": -122.507880000},
{"lat": 37.771490000, "lng": -122.507780000},
{"lat": 37.771530000, "lng": -122.507140000},
{"lat": 37.771550000, "lng": -122.506690000},
{"lat": 37.771560000, "lng": -122.506310000},
{"lat": 37.771600000, "lng": -122.505640000},
{"lat": 37.771650000, "lng": -122.504540000},
{"lat": 37.771670000, "lng": -122.503990000},
{"lat": 37.771700000, "lng": -122.503490000},
{"lat": 37.771740000, "lng": -122.502430000},
{"lat": 37.771790000, "lng": -122.501360000},
{"lat": 37.771840000, "lng": -122.500290000},
{"lat": 37.771870000, "lng": -122.499730000},
{"lat": 37.771890000, "lng": -122.499210000},
{"lat": 37.771940000, "lng": -122.498140000},
{"lat": 37.771990000, "lng": -122.497070000},
{"lat": 37.772000000, "lng": -122.496690000},
{"lat": 37.772020000, "lng": -122.496350000},
{"lat": 37.772030000, "lng": -122.496110000},
{"lat": 37.772040000, "lng": -122.496000000},
{"lat": 37.772040000, "lng": -122.495890000},
{"lat": 37.772060000, "lng": -122.495440000},
{"lat": 37.772090000, "lng": -122.494930000},
{"lat": 37.772120000, "lng": -122.494160000},
{"lat": 37.772130000, "lng": -122.493860000},
{"lat": 37.772180000, "lng": -122.492790000},
{"lat": 37.772200000, "lng": -122.492300000},
{"lat": 37.772220000, "lng": -122.491840000},
{"lat": 37.772230000, "lng": -122.491710000},
{"lat": 37.772280000, "lng": -122.490630000},
{"lat": 37.772330000, "lng": -122.489560000},
{"lat": 37.772330000, "lng": -122.489470000},
{"lat": 37.772360000, "lng": -122.489030000},
{"lat": 37.772380000, "lng": -122.488490000},
{"lat": 37.772430000, "lng": -122.487420000},
{"lat": 37.772450000, "lng": -122.486980000},
{"lat": 37.772480000, "lng": -122.486360000},
{"lat": 37.772520000, "lng": -122.485280000},
{"lat": 37.772560000, "lng": -122.484400000},
{"lat": 37.772570000, "lng": -122.484300000},
{"lat": 37.772570000, "lng": -122.484150000},
{"lat": 37.772620000, "lng": -122.483140000},
{"lat": 37.772680000, "lng": -122.482050000},
{"lat": 37.772700000, "lng": -122.481370000},
{"lat": 37.772710000, "lng": -122.481000000},
{"lat": 37.772730000, "lng": -122.480740000},
{"lat": 37.772770000, "lng": -122.479930000},
{"lat": 37.772820000, "lng": -122.478860000},
{"lat": 37.772870000, "lng": -122.477790000},
{"lat": 37.772900000, "lng": -122.477110000},
{"lat": 37.772920000, "lng": -122.476710000},
{"lat": 37.772960000, "lng": -122.475650000},
{"lat": 37.772990000, "lng": -122.474950000},
{"lat": 37.773010000, "lng": -122.474580000},
{"lat": 37.773060000, "lng": -122.473450000},
{"lat": 37.773120000, "lng": -122.472330000},
{"lat": 37.773140000, "lng": -122.471850000},
{"lat": 37.773140000, "lng": -122.471730000},
{"lat": 37.773150000, "lng": -122.471640000},
{"lat": 37.773170000, "lng": -122.471260000},
{"lat": 37.773190000, "lng": -122.470570000},
{"lat": 37.773210000, "lng": -122.470190000},
{"lat": 37.773230000, "lng": -122.469770000},
{"lat": 37.773250000, "lng": -122.469370000},
{"lat": 37.773260000, "lng": -122.469120000},
{"lat": 37.773290000, "lng": -122.468490000},
{"lat": 37.773300000, "lng": -122.468150000},
{"lat": 37.773310000, "lng": -122.468050000},
{"lat": 37.773310000, "lng": -122.467940000},
{"lat": 37.773320000, "lng": -122.467740000},
{"lat": 37.773350000, "lng": -122.467270000},
{"lat": 37.773360000, "lng": -122.466980000},
{"lat": 37.773360000, "lng": -122.466870000},
{"lat": 37.773370000, "lng": -122.466610000},
{"lat": 37.773390000, "lng": -122.466300000},
{"lat": 37.773400000, "lng": -122.466000000},
{"lat": 37.773400000, "lng": -122.465910000},
{"lat": 37.773410000, "lng": -122.465790000},
{"lat": 37.773430000, "lng": -122.465520000},
{"lat": 37.773460000, "lng": -122.465210000},
{"lat": 37.773490000, "lng": -122.464980000},
{"lat": 37.773500000, "lng": -122.464910000},
{"lat": 37.773460000, "lng": -122.464830000},
{"lat": 37.773560000, "lng": -122.464070000},
{"lat": 37.773580000, "lng": -122.463900000},
{"lat": 37.773590000, "lng": -122.463810000},
{"lat": 37.773600000, "lng": -122.463780000},
{"lat": 37.773610000, "lng": -122.463670000},
{"lat": 37.773660000, "lng": -122.463320000},
{"lat": 37.773740000, "lng": -122.462700000},
{"lat": 37.773770000, "lng": -122.462440000},
{"lat": 37.773860000, "lng": -122.461730000},
{"lat": 37.773870000, "lng": -122.461640000},
{"lat": 37.773920000, "lng": -122.461260000},
{"lat": 37.773970000, "lng": -122.460890000},
{"lat": 37.774010000, "lng": -122.460570000},
{"lat": 37.774110000, "lng": -122.459760000},
{"lat": 37.774140000, "lng": -122.459490000},
{"lat": 37.774270000, "lng": -122.458520000},
{"lat": 37.774270000, "lng": -122.458440000},
{"lat": 37.774270000, "lng": -122.458380000},
{"lat": 37.774320000, "lng": -122.458270000},
{"lat": 37.774340000, "lng": -122.458050000},
{"lat": 37.774510000, "lng": -122.456680000},
{"lat": 37.774560000, "lng": -122.456310000},
{"lat": 37.774700000, "lng": -122.455280000},
{"lat": 37.774760000, "lng": -122.454780000},
{"lat": 37.774770000, "lng": -122.454670000},
{"lat": 37.774770000, "lng": -122.454670000},
{"lat": 37.774670000, "lng": -122.454650000},
{"lat": 37.774670000, "lng": -122.454650000},
{"lat": 37.774580000, "lng": -122.454640000},
{"lat": 37.774300000, "lng": -122.454580000},
{"lat": 37.774190000, "lng": -122.454560000},
{"lat": 37.773700000, "lng": -122.454460000},
{"lat": 37.772910000, "lng": -122.454310000},
{"lat": 37.772620000, "lng": -122.454260000},
{"lat": 37.772430000, "lng": -122.454220000},
{"lat": 37.771980000, "lng": -122.454110000},
{"lat": 37.771910000, "lng": -122.454100000},
{"lat": 37.771760000, "lng": -122.454060000},
{"lat": 37.771690000, "lng": -122.454050000},
{"lat": 37.771620000, "lng": -122.454030000},
{"lat": 37.771530000, "lng": -122.454010000},
{"lat": 37.771380000, "lng": -122.453970000},
{"lat": 37.771250000, "lng": -122.453950000},
{"lat": 37.771100000, "lng": -122.453930000},
{"lat": 37.771020000, "lng": -122.453920000},
{"lat": 37.770920000, "lng": -122.453900000},
{"lat": 37.770810000, "lng": -122.453890000},
{"lat": 37.770660000, "lng": -122.453860000},
{"lat": 37.770110000, "lng": -122.453750000},
{"lat": 37.769560000, "lng": -122.453640000},
{"lat": 37.769360000, "lng": -122.453600000},
{"lat": 37.769250000, "lng": -122.453580000},
{"lat": 37.769180000, "lng": -122.453560000},
{"lat": 37.769090000, "lng": -122.453540000},
{"lat": 37.768780000, "lng": -122.453480000},
{"lat": 37.768250000, "lng": -122.453380000},
{"lat": 37.768160000, "lng": -122.453360000},
{"lat": 37.767820000, "lng": -122.453290000},
{"lat": 37.767310000, "lng": -122.453190000},
{"lat": 37.767160000, "lng": -122.453160000},
{"lat": 37.767010000, "lng": -122.453130000},
{"lat": 37.766760000, "lng": -122.453070000},
{"lat": 37.766550000, "lng": -122.453030000},
{"lat": 37.766550000, "lng": -122.453030000},
{"lat": 37.766390000, "lng": -122.452990000},
{"lat": 37.766390000, "lng": -122.452990000},
{"lat": 37.766290000, "lng": -122.453720000},
{"lat": 37.766180000, "lng": -122.454610000},
{"lat": 37.766130000, "lng": -122.454980000},
{"lat": 37.765960000, "lng": -122.456290000},
{"lat": 37.765960000, "lng": -122.456340000},
{"lat": 37.765960000, "lng": -122.456360000},
{"lat": 37.765960000, "lng": -122.456380000},
{"lat": 37.765960000, "lng": -122.456410000},
{"lat": 37.765960000, "lng": -122.456460000},
{"lat": 37.765940000, "lng": -122.456630000},
{"lat": 37.765930000, "lng": -122.456700000},
{"lat": 37.765920000, "lng": -122.456810000},
{"lat": 37.765910000, "lng": -122.456930000},
{"lat": 37.765910000, "lng": -122.457020000},
{"lat": 37.765920000, "lng": -122.457160000},
{"lat": 37.765930000, "lng": -122.457270000},
{"lat": 37.765940000, "lng": -122.457360000},
{"lat": 37.765950000, "lng": -122.457410000},
{"lat": 37.765960000, "lng": -122.457470000},
{"lat": 37.765980000, "lng": -122.457560000},
{"lat": 37.766010000, "lng": -122.457660000},
{"lat": 37.766070000, "lng": -122.457830000},
{"lat": 37.766070000, "lng": -122.457830000},
{"lat": 37.766120000, "lng": -122.457980000},
{"lat": 37.766180000, "lng": -122.458180000},
{"lat": 37.766190000, "lng": -122.458200000},
{"lat": 37.766240000, "lng": -122.458400000},
{"lat": 37.766270000, "lng": -122.458530000},
{"lat": 37.766290000, "lng": -122.458600000},
{"lat": 37.766300000, "lng": -122.458690000},
{"lat": 37.766300000, "lng": -122.458880000},
{"lat": 37.766300000, "lng": -122.458970000},
{"lat": 37.766280000, "lng": -122.459470000},
{"lat": 37.766270000, "lng": -122.459520000},
{"lat": 37.766270000, "lng": -122.459560000},
{"lat": 37.766280000, "lng": -122.459600000},
{"lat": 37.766280000, "lng": -122.459630000},
{"lat": 37.766290000, "lng": -122.459670000},
{"lat": 37.766300000, "lng": -122.459700000},
{"lat": 37.766310000, "lng": -122.459730000},
{"lat": 37.766320000, "lng": -122.459750000},
{"lat": 37.766330000, "lng": -122.459770000},
{"lat": 37.766350000, "lng": -122.459800000},
{"lat": 37.766390000, "lng": -122.459860000},
{"lat": 37.766340000, "lng": -122.459970000},
{"lat": 37.766290000, "lng": -122.460150000},
{"lat": 37.766290000, "lng": -122.460230000},
{"lat": 37.766280000, "lng": -122.460280000},
{"lat": 37.766260000, "lng": -122.460330000},
{"lat": 37.766250000, "lng": -122.460420000},
{"lat": 37.766240000, "lng": -122.460520000},
{"lat": 37.766230000, "lng": -122.460670000},
{"lat": 37.766230000, "lng": -122.460800000},
{"lat": 37.766230000, "lng": -122.460900000},
{"lat": 37.766210000, "lng": -122.461110000},
{"lat": 37.766170000, "lng": -122.462030000},
{"lat": 37.766160000, "lng": -122.462170000},
{"lat": 37.766150000, "lng": -122.462520000},
{"lat": 37.766120000, "lng": -122.463260000},
{"lat": 37.766090000, "lng": -122.464130000},
{"lat": 37.766070000, "lng": -122.464350000},
{"lat": 37.766070000, "lng": -122.464440000},
{"lat": 37.766060000, "lng": -122.464620000},
{"lat": 37.766030000, "lng": -122.465400000},
{"lat": 37.765980000, "lng": -122.466470000},
{"lat": 37.765940000, "lng": -122.467530000},
{"lat": 37.765930000, "lng": -122.467680000},
{"lat": 37.765890000, "lng": -122.468600000},
{"lat": 37.765860000, "lng": -122.468980000},
{"lat": 37.765830000, "lng": -122.469660000},
{"lat": 37.765780000, "lng": -122.470740000},
{"lat": 37.765770000, "lng": -122.471030000},
{"lat": 37.765770000, "lng": -122.471140000},
{"lat": 37.765760000, "lng": -122.471380000},
{"lat": 37.765740000, "lng": -122.471820000},
{"lat": 37.765690000, "lng": -122.472950000},
{"lat": 37.765680000, "lng": -122.473220000},
{"lat": 37.765670000, "lng": -122.473320000},
{"lat": 37.765640000, "lng": -122.474070000},
{"lat": 37.765590000, "lng": -122.475140000},
{"lat": 37.765590000, "lng": -122.475400000},
{"lat": 37.765580000, "lng": -122.475520000},
{"lat": 37.765550000, "lng": -122.476200000},
{"lat": 37.765500000, "lng": -122.477180000},
{"lat": 37.765500000, "lng": -122.477280000},
{"lat": 37.765490000, "lng": -122.477400000},
{"lat": 37.765490000, "lng": -122.477440000},
{"lat": 37.765490000, "lng": -122.477440000},
{"lat": 37.765490000, "lng": -122.477490000},
{"lat": 37.765470000, "lng": -122.477770000},
{"lat": 37.765450000, "lng": -122.478340000},
{"lat": 37.765450000, "lng": -122.478420000},
{"lat": 37.765430000, "lng": -122.478870000},
{"lat": 37.765400000, "lng": -122.479430000},
{"lat": 37.765380000, "lng": -122.479810000},
{"lat": 37.765350000, "lng": -122.480480000},
{"lat": 37.765300000, "lng": -122.481570000},
{"lat": 37.765300000, "lng": -122.481660000},
{"lat": 37.765290000, "lng": -122.481950000},
{"lat": 37.765260000, "lng": -122.482640000},
{"lat": 37.765220000, "lng": -122.483570000},
{"lat": 37.765210000, "lng": -122.483710000},
{"lat": 37.765210000, "lng": -122.483810000},
{"lat": 37.765190000, "lng": -122.484130000},
{"lat": 37.765160000, "lng": -122.484780000},
{"lat": 37.765120000, "lng": -122.485860000},
{"lat": 37.765110000, "lng": -122.485960000},
{"lat": 37.765100000, "lng": -122.486170000},
{"lat": 37.765070000, "lng": -122.486930000},
{"lat": 37.765020000, "lng": -122.488000000},
{"lat": 37.765020000, "lng": -122.488100000},
{"lat": 37.765000000, "lng": -122.488360000},
{"lat": 37.764980000, "lng": -122.488970000},
{"lat": 37.764970000, "lng": -122.489070000},
{"lat": 37.764930000, "lng": -122.490150000},
{"lat": 37.764920000, "lng": -122.490240000},
{"lat": 37.764910000, "lng": -122.490490000},
{"lat": 37.764880000, "lng": -122.491210000},
{"lat": 37.764830000, "lng": -122.492290000},
{"lat": 37.764790000, "lng": -122.493260000},
{"lat": 37.764780000, "lng": -122.493350000},
{"lat": 37.764740000, "lng": -122.494420000},
{"lat": 37.764720000, "lng": -122.494730000},
{"lat": 37.764710000, "lng": -122.495500000},
{"lat": 37.764700000, "lng": -122.495630000},
{"lat": 37.764690000, "lng": -122.495940000},
{"lat": 37.764680000, "lng": -122.496260000},
{"lat": 37.764670000, "lng": -122.496480000},
{"lat": 37.764600000, "lng": -122.497490000},
{"lat": 37.764590000, "lng": -122.497650000},
{"lat": 37.764550000, "lng": -122.498720000},
{"lat": 37.764500000, "lng": -122.499780000},
{"lat": 37.764450000, "lng": -122.500870000},
{"lat": 37.764440000, "lng": -122.501060000},
{"lat": 37.764400000, "lng": -122.501930000},
{"lat": 37.764360000, "lng": -122.502990000},
{"lat": 37.764310000, "lng": -122.504080000},
{"lat": 37.764260000, "lng": -122.505140000},
{"lat": 37.764260000, "lng": -122.505250000},
{"lat": 37.764220000, "lng": -122.506220000},
{"lat": 37.764170000, "lng": -122.507280000},
{"lat": 37.764120000, "lng": -122.508360000},
{"lat": 37.764100000, "lng": -122.508850000},
{"lat": 37.764100000, "lng": -122.509150000},
{"lat": 37.764100000, "lng": -122.509440000},
{"lat": 37.764090000, "lng": -122.509760000},
{"lat": 37.764080000, "lng": -122.510200000},
{"lat": 37.764070000, "lng": -122.510320000},
{"lat": 37.764060000, "lng": -122.510430000},
{"lat": 37.764030000, "lng": -122.510430000},
{"lat": 37.764030000, "lng": -122.510430000},
{"lat": 37.763960000, "lng": -122.510430000},
{"lat": 37.763960000, "lng": -122.510290000},
{"lat": 37.764070000, "lng": -122.510320000},
{"lat": 37.764170000, "lng": -122.510320000},
{"lat": 37.764410000, "lng": -122.510340000},
{"lat": 37.764610000, "lng": -122.510350000},
{"lat": 37.764780000, "lng": -122.510330000},
{"lat": 37.764960000, "lng": -122.510310000},
{"lat": 37.765340000, "lng": -122.510280000},
{"lat": 37.765570000, "lng": -122.510260000},
{"lat": 37.765840000, "lng": -122.510250000},
{"lat": 37.765900000, "lng": -122.510250000},
{"lat": 37.766140000, "lng": -122.510260000},
{"lat": 37.766410000, "lng": -122.510260000},
{"lat": 37.766620000, "lng": -122.510270000},
{"lat": 37.767040000, "lng": -122.510310000},
{"lat": 37.767270000, "lng": -122.510330000},
{"lat": 37.767620000, "lng": -122.510390000},
{"lat": 37.767670000, "lng": -122.510390000},
{"lat": 37.767740000, "lng": -122.510410000},
{"lat": 37.767840000, "lng": -122.510430000},
{"lat": 37.768280000, "lng": -122.510530000},
{"lat": 37.768620000, "lng": -122.510600000},
{"lat": 37.768690000, "lng": -122.510620000},
{"lat": 37.769020000, "lng": -122.510690000},
{"lat": 37.769260000, "lng": -122.510730000},
{"lat": 37.769420000, "lng": -122.510750000},
{"lat": 37.770010000, "lng": -122.510830000},
{"lat": 37.770340000, "lng": -122.510860000},
{"lat": 37.770460000, "lng": -122.510870000},
{"lat": 37.770930000, "lng": -122.510930000},
{"lat": 37.770980000, "lng": -122.510930000},
]

def on_connect(client, userdata, flags, rc):
    print(f"Connected with result code {rc}")

client = mqtt.Client()
client.on_connect = on_connect
client.username_pw_set(ACCESS_TOKEN)
client.connect(BROKER, PORT, 60)

client.loop_start()

# Function to generate random OBD data
def generate_obd_data(lat,lng):
    return {
        "latitude": lat,
        "longitude": lng,
        "speed": random.uniform(0, 150),
        "engine_status": random.choice(["ON", "OFF"]),
        "mileage": random.uniform(0, 200000),  # in kilometers
        "vehicle_status": random.choice(["Running", "Idle", "Maintenance Required"]),
        "issues": random.choice(["None", "Engine Issue", "Transmission Issue", "Sensor Fault"]),
        "temperature": random.uniform(-10, 40),  # in Celsius
        "ambient_temperature": random.uniform(-10, 40)  # in Celsius
    }

# Simulate historical data over a period of time
start_time = datetime.now() - timedelta(days=7)
current_route_index = 0
while start_time < datetime.now():
    point = ROUTE_COORDINATES[current_route_index]
    payload = generate_obd_data(point["lat"], point["lng"])
    payload["timestamp"] = start_time.strftime("%Y-%m-%dT%H:%M:%S")
    client.publish(TOPIC, json.dumps(payload))
    print(f"Published: {payload}")
    start_time += timedelta(minutes=10)  # Simulate data every 10 minutes
    time.sleep(2)  # Adjust as needed
    current_route_index = (current_route_index + 1) % len(ROUTE_COORDINATES)

client.loop_stop()
client.disconnect()
